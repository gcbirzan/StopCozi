"use strict";!function(e){var t=e.module("datePicker",[]);t.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5,firstDay:0}),t.filter("mFormat",function(){return function(e,t,n){return moment.isMoment(e)?n?moment.tz(e,n).format(t):e.format(t):moment(e).format(t)}}),t.directive("datePicker",["datePickerConfig","datePickerUtils",function(t,n){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(i,a,r,s){function o(){i.views=t.views.concat(),i.view=r.view||t.view,i.views=i.views.slice(i.views.indexOf(r.maxView||"year"),i.views.indexOf(r.minView||"minutes")+1),(1===i.views.length||-1===i.views.indexOf(i.view))&&(i.view=i.views[0])}function m(e){return n.getDate(i,r,e)}function d(e){e&&(i.model=e,s&&s.$setViewValue(e)),i.$emit("setDate",i.model,i.view),i.callbackOnSetDate&&i.callbackOnSetDate(r.datePicker,i.date)}function c(){var e=i.view;n.setParams(w,S),i.model&&!g&&(i.date=y(i.model),g=!1);var t=i.date;switch(e){case"year":i.years=n.getVisibleYears(t);break;case"month":i.months=n.getVisibleMonths(t);break;case"date":i.weekdays=i.weekdays||n.getDaysOfWeek(),i.weeks=n.getVisibleWeeks(t);break;case"hours":i.hours=n.getVisibleHours(t);break;case"minutes":i.minutes=n.getVisibleMinutes(t,k)}l()}function u(){return"date"!==i.view?i.view:i.date?i.date.month():null}function l(){var e,a,r=i.view,s=i.date,o=[],m="";if(n.setParams(w,S),"date"===r){var d,c=i.weeks;for(e=0;e<c.length;e++)for(d=c[e],o.push([]),a=0;a<d.length;a++)m="",n.isSameDay(s,d[a])&&(m+="active"),v(d[a],r)&&(m+=" now"),d[a].month()===s.month()&&f(d[a])||(m+=" disabled"),o[e].push(m)}else{var u=t.viewConfig[r],l=i[u[0]],h=u[1];for(e=0;e<l.length;e++)m="",n[h](s,l[e])&&(m+="active"),v(l[e],r)&&(m+=" now"),f(l[e])||(m+=" disabled"),o.push(m)}i.classes=o}function f(e){var t=!0;return x&&x.isAfter(e)&&(t=h(x,e)),M&&M.isBefore(e)&&(t&=h(M,e)),t}function h(e,n){return e.isSame(n,t.momentNames[i.view])?!0:!1}function p(e){return x&&x.isAfter(e)?x:M&&M.isBefore(e)?M:e}function v(e,t){var n=!0;switch(t){case"minutes":n&=~~($.minutes()/k)===~~(e.minutes()/k);case"hours":n&=$.hours()===e.hours();case"date":n&=$.date()===e.date();case"month":n&=$.month()===e.month();case"year":n&=$.year()===e.year()}return n}var g=!1,w=i.tz=r.timezone,y=n.createMoment,D=n.eventIsForPicker,k=parseInt(r.step||t.step,10),b=!!r.partial,x=m("minDate"),M=m("maxDate"),V=a[0].id,$=i.now=y(),C=i.date=y(i.model||$),P="true"===r.autoClose,S=r.firstDay&&r.firstDay>=0&&r.firstDay<=6?parseInt(r.firstDay,10):t.firstDay;n.setParams(w,S),i.model||C.minute(Math.ceil(C.minute()/k)*k).second(0),i.template=r.template||t.template,i.watchDirectChanges=void 0!==r.watchDirectChanges,i.callbackOnSetDate=r.dateChange?n.findFunction(i,r.dateChange):void 0,o(),i.setView=function(e){-1!==i.views.indexOf(e)&&(i.view=e)},i.selectDate=function(e){if(r.disabled)return!1;if(h(i.date,e)&&(e=i.date),e=p(e),!e)return!1;i.date=e;var t=i.views[i.views.indexOf(i.view)+1];(!t||b||i.model)&&d(e),t?i.setView(t):P?(a.addClass("hidden"),i.$emit("hidePicker")):l()},i.$watch(u,c),i.watchDirectChanges&&i.$watch("model",function(){g=!1,c()}),i.next=function(e){var t=moment(i.date);switch(e=e||1,i.view){case"year":case"month":t.year(t.year()+e);break;case"date":t.month(t.month()+e);break;case"hours":case"minutes":t.hours(t.hours()+e)}t=p(t),t&&(i.date=t,d(t),g=!0,c())},i.prev=function(e){return i.next(-e||-1)},V&&i.$on("pickerUpdate",function(t,n,i){if(D(n,V)){var a=!1,s=!1;e.isDefined(i.minDate)&&(x=i.minDate?i.minDate:!1,s=!0),e.isDefined(i.maxDate)&&(M=i.maxDate?i.maxDate:!1,s=!0),e.isDefined(i.minView)&&(r.minView=i.minView,a=!0),e.isDefined(i.maxView)&&(r.maxView=i.maxView,a=!0),r.view=i.view||r.view,a&&o(),s&&c()}})}}}]),e.module("datePicker").factory("datePickerUtils",function(){var t,n,i=function(e,n,i,a,r){var s=Date.UTC(0|e,0|n,0|i,0|a,0|r);return t?moment.tz(s,t):moment(s)};return{getVisibleMinutes:function(e,a){e=e&&e.isValid()?e:t?moment.tz(t).day(n):moment().day(n);var r,s,o=e.year(),m=e.month(),d=e.date(),c=e.hours(),u=e.utcOffset()/60,l=[];for(s=0;60>s;s+=a)r=i(o,m,d,c-u,s),l.push(r);return l},getVisibleWeeks:function(e){e=moment(e),e=e&&e.isValid()?e:t?moment.tz(t).day(n):moment().day(n);var i=e.year(),a=e.month();e.date(1);var r=e.day();e.date(n-(r+(n>=r?6:-1)));for(var s=[];s.length<6&&!(e.year()===i&&e.month()>a);)s.push(this.getDaysOfWeek(e)),e.add(7,"d");return s},getVisibleYears:function(e){var a=moment(e),r=a.year();a=a&&a.isValid()?a:t?moment.tz(t).day(n):moment().day(n),a.year(r-r%10),r=a.year();for(var s,o,m=a.utcOffset()/60,d=[],c=0;12>c;c++)s=i(r,0,1,0-m),o=s.utcOffset()/60,o!==m&&(s=i(r,0,1,0-o),m=o),d.push(s),r++;return d},getDaysOfWeek:function(e){e=e&&e.isValid()?e:t?moment.tz(t).day(n):moment().day(n);for(var a,r,s=e.year(),o=e.month(),m=e.date(),d=[],c=e.utcOffset()/60,u=0;7>u;u++)a=i(s,o,m,0-c,0,!1),r=a.utcOffset()/60,r!==c&&(a=i(s,o,m,0-r,0,!1)),d.push(a),m++;return d},getVisibleMonths:function(e){e=e&&e.isValid()?e:t?moment.tz(t).day(n):moment().day(n);for(var a,r,s=e.year(),o=e.utcOffset()/60,m=[],d=0;12>d;d++)a=i(s,d,1,0-o,0,!1),r=a.utcOffset()/60,r!==o&&(a=i(s,d,1,0-r,0,!1)),m.push(a);return m},getVisibleHours:function(e){e=e&&e.isValid()?e:t?moment.tz(t).day(n):moment().day(n);var a,r,s,o=e.year(),m=e.month(),d=e.date(),c=[],u=e.utcOffset()/60;for(a=0;24>a;a++)r=i(o,m,d,a-u,0,!1),s=r.utcOffset()/60,s!==u&&(r=i(o,m,d,a-s,0,!1)),c.push(r);return c},isAfter:function(e,t){return e&&e.unix()>=t.unix()},isBefore:function(e,t){return e.unix()<=t.unix()},isSameYear:function(e,t){return e&&e.year()===t.year()},isSameMonth:function(e,t){return this.isSameYear(e,t)&&e.month()===t.month()},isSameDay:function(e,t){return this.isSameMonth(e,t)&&e.date()===t.date()},isSameHour:function(e,t){return this.isSameDay(e,t)&&e.hours()===t.hours()},isSameMinutes:function(e,t){return this.isSameHour(e,t)&&e.minutes()===t.minutes()},setParams:function(e,i){t=e,n=i},scopeSearch:function(e,t,n){var i,a,r=e,s=t.split("."),o=s.length;do{for(i=r=r.$parent,a=0;o>a;a++){i=i[s[a]]}if(i&&n(i))return i}while(r.$parent);return!1},findFunction:function(t,n){return this.scopeSearch(t,n,function(t){return e.isFunction(t)})},findParam:function(e,t){return this.scopeSearch(e,t,function(){return!0})},createMoment:function(e){return t?moment.tz(e,t):moment.isMoment(e)?moment.unix(e.unix()):moment(e)},getDate:function(e,t,n){var i=!1;return t[n]&&(i=this.createMoment(t[n]),i.isValid()||(i=this.findParam(e,t[n]),i&&(i=this.createMoment(i)))),i},eventIsForPicker:function(t,n){return e.isArray(t)&&t.indexOf(n)>-1||t===n}}});var t=e.module("datePicker");t.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function(t,n,i){function a(t,n,a,r,s){return i.template(e.extend(t,{ngModel:a,minDate:r&&moment.isMoment(r)?r.format():!1,maxDate:s&&moment.isMoment(s)?s.format():!1}),n)}function r(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(i,s,o){function m(e){i.$broadcast("pickerUpdate",l[0],{maxDate:e})}function d(e){i.$broadcast("pickerUpdate",l[1],{minDate:e})}var c=null,u=s[0].id,l=[r(),r()],f=n.createMoment,h=n.eventIsForPicker;i.dateChange=function(e,t){c&&c(e,t)},u&&i.$on("pickerUpdate",function(e,t,n){h(t,u)&&i.$broadcast("pickerUpdate",l,n)}),n.setParams(o.timezone),i.start=f(i.start),i.end=f(i.end),i.$watchGroup(["start","end"],function(e){d(e[0]),m(e[1])}),e.isDefined(o.dateChange)&&(c=n.findFunction(i,o.dateChange)),o.onSetDate="dateChange";var p='<div><table class="date-range"><tr><td valign="top">'+a(o,l[0],"start",!1,i.end)+'</td><td valign="top">'+a(o,l[1],"end",i.start,!1)+"</td></tr></table></div>",v=t(p)(i);s.append(v)}}}]);var n="ng-pristine",i="ng-dirty",t=e.module("datePicker");t.constant("dateTimeConfig",{template:function(e,t){return"<div "+(t?'id="'+t+'" ':"")+'date-picker="'+e.ngModel+'" '+(e.view?'view="'+e.view+'" ':"")+(e.maxView?'max-view="'+e.maxView+'" ':"")+(e.maxDate?'max-date="'+e.maxDate+'" ':"")+(e.autoClose?'auto-close="'+e.autoClose+'" ':"")+(e.template?'template="'+e.template+'" ':"")+(e.minView?'min-view="'+e.minView+'" ':"")+(e.minDate?'min-date="'+e.minDate+'" ':"")+(e.partial?'partial="'+e.partial+'" ':"")+(e.step?'step="'+e.step+'" ':"")+(e.onSetDate?'date-change="'+e.onSetDate+'" ':"")+(e.ngModel?'ng-model="'+e.ngModel+'" ':"")+(e.firstDay?'first-day="'+e.firstDay+'" ':"")+(e.timezone?'timezone="'+e.timezone+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),t.directive("dateTimeAppend",function(){return{link:function(e,t){t.bind("click",function(){t.find("input")[0].focus()})}}}),t.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(t,a,r,s,o,m){var d=a.find("body"),c=r("mFormat");return{require:"ngModel",scope:!0,link:function(a,r,u,l){function f(e){var t=c(e,b,U);return t==moment.localeData().invalidDate()&&(t=null),t}function h(e){return(e=moment(e,b)).isValid()?e:null}function p(e){O=e,u.minDate=e?e.format():e,F=moment.isMoment(e)}function v(e){H=e,u.maxDate=e?e.format():e,q=moment.isMoment(e)}function g(){k=s.template(u)}function w(e){e.stopPropagation(),l.$pristine&&(l.$dirty=!0,l.$pristine=!1,r.removeClass(n).addClass(i),x&&x.$setDirty(),l.$render())}function y(){P&&(P.remove(),P=null),Y&&(Y.remove(),Y=null)}function D(){if(!P){if(P=t(k)(a),a.$digest(),T||(a.$on("setDate",function(e,t,n){w(e),I&&I(u.ngModel,t),C&&M[M.length-1]===n&&y()}),a.$on("hidePicker",function(){r.triggerHandler("blur")}),a.$on("$destroy",y),T=!0),"absolute"===z){var n=e.extend(r.offset(),{height:r[0].offsetHeight});P.css({top:n.top+n.height,left:n.left,display:"block",position:z}),d.append(P)}else Y=e.element("<div date-picker-wrapper></div>"),r[0].parentElement.insertBefore(Y[0],r[0]),Y.append(P),P.css({top:r[0].offsetHeight+"px",display:"block"});P.bind("mousedown",function(e){e.preventDefault()})}}var k,b=u.format||s.format,x=r.inheritedData("$formController"),M=o(u.views)(a)||s.views.concat(),V=u.view||M[0],$=M.indexOf(V),C=u.autoClose?o(u.autoClose)(a):s.autoClose,P=null,S=r[0].id,z=u.position||s.position,Y=null,O=null,F=null,H=null,q=null,U=u.timezone||!1,A=m.eventIsForPicker,I=null,T=!1;-1===$&&M.splice($,1),M.unshift(V),l.$formatters.push(f),l.$parsers.unshift(h),e.isDefined(u.minDate)&&(p(m.findParam(a,u.minDate)),l.$validators.min=function(e){return F?moment.isMoment(e)&&(O.isSame(e)||O.isBefore(e)):!0}),e.isDefined(u.maxDate)&&(v(m.findParam(a,u.maxDate)),l.$validators.max=function(e){return q?moment.isMoment(e)&&(H.isSame(e)||H.isAfter(e)):!0}),e.isDefined(u.dateChange)&&(I=m.findFunction(a,u.dateChange)),S&&a.$on("pickerUpdate",function(t,n,i){if(A(n,S))if(P);else{var a=!1;e.isDefined(i.minDate)&&(p(i.minDate),a=!0),e.isDefined(i.maxDate)&&(v(i.maxDate),a=!0),e.isDefined(i.minView)&&(u.minView=i.minView),e.isDefined(i.maxView)&&(u.maxView=i.maxView),u.view=i.view||u.view,a&&l.$validate(),e.isDefined(i.format)&&(b=u.format=i.format||s.format,l.$modelValue=-1),g()}}),r.bind("focus",D),r.bind("blur",y),g()}}}]),e.module("datePicker").run(["$templateCache",function(e){e.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div ng-switch-when="date">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|mFormat:\'YYYY MMMM\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      <tr>\r\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|mFormat:\'ddd\':tz"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr ng-repeat="week in weeks" ng-init="$index2 = $index">\r\n        <td ng-repeat="day in week">\r\n          <span\r\n            ng-class="classes[$index2][$index]"\r\n            ng-click="selectDate(day)" ng-bind="day|mFormat:\'DD\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="year">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(10)">&lsaquo;</th>\r\n        <th colspan="5" class="switch"ng-bind="years[0].year()+\' - \'+years[years.length-1].year()"></th>\r\n        <th ng-click="next(10)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="classes[$index]"\r\n                ng-repeat="year in years"\r\n                ng-click="selectDate(year)" ng-bind="year.year()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="month">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|mFormat:\'YYYY\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(month)"\r\n                ng-bind="month|mFormat:\'MMM\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="hours">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(24)">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n        <th ng-click="next(24)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(hour)" ng-bind="hour|mFormat:\'HH:mm\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="minutes">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(minute)"\r\n                ng-bind="minute|mFormat:\'HH:mm\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>')}])}(angular);